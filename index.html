<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Park Visit Certification</title>
    <style>
      #map {
        width: 100%;
        height: 100vh;
      }
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
    </style>
    <script
      type="text/javascript"
      src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=0sq0mb7npe"
    ></script>
  </head>
  <body>
    <div id="map"></div>
    <script>
      // JSON 파일에서 공원 데이터를 불러오기
      function fetchParksData() {
        return fetch("park_list.json")
          .then((response) => response.json())
          .catch((error) => console.error("Error loading park data:", error));
      }

      function initMap(parks) {
        // 사용자의 현재 위치를 가져오기 위한 Geolocation API 사용
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(
            (position) => {
              const userLocation = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
              };

              const map = new naver.maps.Map("map", {
                center: new naver.maps.LatLng(
                  userLocation.latitude,
                  userLocation.longitude
                ),
                zoom: 16,
              });

              // 사용자의 현재 위치를 지도에 표시
              new naver.maps.Marker({
                position: new naver.maps.LatLng(
                  userLocation.latitude,
                  userLocation.longitude
                ),
                map: map,
                title: "Your Location",
              });

              // 공원 데이터를 지도에 표시
              parks.forEach((park) => {
                const parkLatLng = new naver.maps.LatLng(park._X, park._Y);
                new naver.maps.Circle({
                  map: map,
                  center: parkLatLng,
                  radius: Math.sqrt(park.area),
                  strokeColor: "#5347AA",
                  strokeOpacity: 0.8,
                  strokeWeight: 2,
                  fillColor: "#CFE7FF",
                  fillOpacity: 0.6,
                });

                new naver.maps.Marker({
                  position: parkLatLng,
                  map: map,
                  title: park.name,
                });
              });
            },
            (error) => {
              console.error("Error getting user location:", error);
              alert("사용자의 위치를 가져올 수 없습니다.");
            }
          );
        } else {
          alert("Geolocation을 지원하지 않는 브라우저입니다.");
        }
      }

      // 페이지 로드 시 공원 데이터를 불러오고 지도 초기화
      document.addEventListener("DOMContentLoaded", () => {
        fetchParksData().then((parks) => {
          if (parks) {
            initMap(parks);
          }
        });
      });
    </script>
  </body>
</html>
